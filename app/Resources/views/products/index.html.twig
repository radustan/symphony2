{% extends 'template.html.twig' %}
{% block stylesheets %}
{% endblock %}
{% block title %} Products {% endblock %}
{% block body %}
    <div>
        <h2 class="page-header">
            Products List
        </h2>
    </div>
    <div>
        {% for flash_message in app.session.flashbag.get('notice') %}
            <div class="alert alert-info" role="alert"> {{ flash_message }}</div>
        {% endfor %}
    </div>
    <div class="container-with-parent-selector block-padding">
        <a href="#" data-toggle="modal" data-target="#myModal" class="btn btn-warning pull-right"><i
                    class="glyphicon glyphicon-plus-sign"></i> Add product</a>
        <div class="clearfix"></div>
        <div class="top10">
            <table class="table table-bordered table-condensed table-striped primary-table" width="100%">
                <thead>
                <tr>
                    {% for header in headers %}
                        <th>{{ header }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                {% for product in products %}
                    <tr>
                        <td>{{ product.get('name') }}</td>
                        <td>{{ product.get('price') }}</td>
                        <td>
                            {% if product.get('image') %}
                                <img height="30px" width="40px" src="{{ product.get('image').getURL() }}"
                                     alt="{{ product.get('image').getName() }}">
                            {% endif %}
                        </td>
                        <td>
                            {% if product.get('location') %}
                            <a href="#" data-toggle="modal" data-target="#locationModal"
                                   data-lat="{{ product.get('location').getLatitude() }}"
                                   data-long="{{ product.get('location').getLongitude() }}"
                                   class="btn btn-default locationShow">
                                    <i class="glyphicon glyphicon-map-marker"></i> View on map
                                </a>
                            {% endif %}
                        </td>
                        <td>{{ product.getUpdatedAt()|date('Y-m-d H:i:s') }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div id="myModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <form id="addProductForm" action="{{ path('products.add') }}" redirect="{{ path('products') }}">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Add a product</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="name">Name</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="Name">
                        </div>
                        <div class="form-group">
                            <label for="price">Price</label>
                            <input type="text" class="form-control" id="name" name="price" placeholder="Price">
                        </div>
                        <hr>
                        <div class="form-group row">
                            <div class="col-md-6">
                                <label class="control-label">Select Image</label>
                                <input id="imageInput" data-allowed-file-extensions='["jpg", "png"]' name="image"
                                       type="file"
                                       class="file">
                            </div>
                            <div class="col-md-6 preview" hidden="hidden">
                                <img id="previewImage" src="#" alt="your image" width="40px" height="40px"/>
                            </div>
                        </div>
                        <hr>
                        <div class="form-group row">
                            <div class="col-sm-12">
                                <label class="control-label">Set Location</label>
                            </div>
                            <div class="col-sm-4">
                                <label for="latitude" class="control-label">Latitude</label>
                                <input type="text" name="latitude" id="lat" class="form-control">

                            </div>
                            <div class="col-sm-4">
                                <label for="longitude" class="control-label">Longitude</label>
                                <input type="text" name="longitude" id="long" class="form-control">

                            </div>
                            <div class="col-sm-5 top10">
                                <button class="btn btn-warning" id="getLoc">
                                    Get current location
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <input type="submit" id="createPrdBtn" value="Create" class="btn btn-primary"/>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="locationModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">View location</h4>
                </div>
                <div class="modal-body">
                    <div id="mapholder"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('js/products.js') }}"></script>
{% endblock %}
